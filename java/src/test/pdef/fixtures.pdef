module io.pdef.test;

enum ObjectType {
    OBJECT, USER, POST, PHOTO, NOTE, EVENT;
}


message GenericObject polymorphic on "type" as ObjectType.OBJECT {
    id          string;
    type        ObjectType;
    timestamp   int64;
}

message User inherits GenericObject as ObjectType.USER {
    isActive    bool;
    name        string;
    age         int32;
    sex         Sex;
    profile     Profile;
    floats      map<string, float>;
    chats       list<Chat>;
    shorts      map<int16, int64>;
    ints        set<int32>;
    weight      double;      
}

message Post inherits GenericObject as ObjectType.POST {
    userId      string;
}

message Photo inherits Post as ObjectType.PHOTO {
    url         string;
}

message Note inherits Post as ObjectType.NOTE {
    text        string;
}

message Profile {
    firstName   string;
    lastName    string;
    birthday    Birthday;
    avatar      int64;
    wallpaper   int64;

    preferedLanguage Language;

	telephone   string;
	info        string;

    complete    bool;
}

message Chat {
    messages    list<string>;
}

enum EventType {
    GENERIC, SYSTEM;
}

message Event
        inherits GenericObject as ObjectType.EVENT
        polymorphic on "eventType" as EventType.GENERIC {
    eventType  EventType;
    ip         string;
}

message SystemEvent inherits Event as EventType.SYSTEM {
    process     string;
}

enum Sex {
    MALE, FEMALE;
}

enum Language {
    EN, RU, FR, DE;
}

message Birthday {
    year    int32;
    month   int32;
    day     int32;
}
