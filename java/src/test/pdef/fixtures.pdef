module pdef.fixtures;

enum ObjectType {
    OBJECT, USER, POST, EVENT, PHOTO, NOTE, SYSTEM_EVENT;
}

message Id polymorphic on "type" as ObjectType.OBJECT {
    type    ObjectType;
}

message UserId inherits Id as ObjectType.USER {
    value       int64;
}

message PostId inherits Id as ObjectType.POST {}
message PhotoId inherits PostId as ObjectType.PHOTO {
    photoId     int64;
}
message NoteId inherits PostId as ObjectType.NOTE {
    noteId      int64;
}

message GenericObject
    polymorphic on "type" as ObjectType.OBJECT {
    type        ObjectType;
    timestamp   int64;
}

message User inherits GenericObject as ObjectType.USER {
    id          UserId;
    name        string;
    age         int32;
    sex         Sex;
    profile     Profile;
    floats      map<string, float>;
}

message Post inherits GenericObject as ObjectType.POST {
    userId      UserId;
}

message Photo inherits Post as ObjectType.PHOTO {
    url         string;
}

message Note inherits Post as ObjectType.NOTE {
    text        string;
}

message Profile {
    firstName   string;
    lastName    string;
    birthday    Birthday;
    avatar      int64;
    wallpaper   int64;

    preferedLanguage Language;

	telephone   string;
	info        string;

    complete    bool;
}

enum Sex {
    MALE, FEMALE;
}

enum Language {
    EN, RU, FR, DE;
}

message Birthday {
    year    int32;
    month   int32;
    day     int32;
}

message Weighted<E, W> {
    element E;
    weight  W;
}

message WeightedSet<E, W> {
    elements set<Weighted<E, W>>;
}

message Chat {
    messages WeightedSet<Birthday, int64>;
}
